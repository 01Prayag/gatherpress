!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var t=window.wp.element,n=window.wp.i18n,r=window.wp.plugins,a=window.wp.editPost,o=window.moment,i=e.n(o),s=(window.wp.notices,window.wp.data);function l(){wp.data.dispatch("core/editor").editPost({meta:{_non_existing_meta:!0}})}var u=window.wp.components,c=window.wp.date;const m=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,r]of Object.entries(e)){let e=n;t&&(e+=t);const a=new CustomEvent(e,{detail:r});dispatchEvent(a)}},d="YYYY-MM-DDTHH:mm:ss",g=i()().add(1,"day").set("hour",18).set("minute",0).format(d),p=e=>{const{dateTimeStart:t}=e,n=(0,c.getSettings)();return(0,c.dateI18n)(`${n.formats.date} ${n.formats.time}`,t,!1)},_=e=>{const{dateTimeEnd:t}=e,n=(0,c.getSettings)();return(0,c.dateI18n)(`${n.formats.date} ${n.formats.time}`,t,!1)},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(e),GatherPress.event_datetime.datetime_start=e,null!==t&&t(e);const n={setDateTimeEnd:e};m(n),l()};function f(e){const t=i()(GatherPress.event_datetime.datetime_end).valueOf(),n=i()(e).valueOf();n>=t&&function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;w(e),GatherPress.event_datetime.datetime_start=e,null!==t&&t(e),m({setDateTimeEnd:e}),l()}(i()(n).add(2,"hours").format(d)),h()}function h(){const e="gp_event_past",t=wp.data.dispatch("core/notices"),r=i()().valueOf()>i()(GatherPress.event_datetime.datetime_end).valueOf();t.removeNotice(e),r&&t.createNotice("warning",(0,n.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!1})}function w(e){const t=i()(GatherPress.event_datetime.datetime_start).valueOf(),n=i()(e).valueOf();if(n<=t){const e=i()(n).subtract(2,"hours").format(d);v(e)}h()}const E=e=>{const{dateTimeStart:n,setDateTimeStart:r}=e,a=(0,c.getSettings)(),o=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(u.DateTimePicker,{currentDate:n,onChange:e=>v(e,r),is12Hour:o})},P=e=>{const{dateTimeEnd:n,setDateTimeEnd:r}=e,a=(0,c.getSettings)(),o=/a(?!\\)/i.test(a.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(u.DateTimePicker,{currentDate:n,onChange:e=>v(e,r),is12Hour:o})};var T=r=>{const[a,o]=(0,t.useState)(),[s,l]=(0,t.useState)();return(0,t.useEffect)((()=>{o(i()((()=>{let e=GatherPress.event_datetime.datetime_start;return e=""!==e?i()(e).format(d):g,GatherPress.event_datetime.datetime_start=e,e})()).format(d)),l(i()((()=>{let t=e.g.GatherPress.event_datetime.datetime_end;return t=""!==t?i()(t).format(d):i()(g).add(2,"hours").format(d),GatherPress.event_datetime.datetime_end=t,t})()).format(d))})),(0,t.createElement)("section",null,(0,t.createElement)("h3",null,(0,n.__)("Date & time","gatherpress")),(0,t.createElement)(u.PanelRow,null,(0,t.createElement)(u.Flex,null,(0,t.createElement)(u.FlexItem,null,(0,n.__)("Start","gatherpress")),(0,t.createElement)(u.FlexItem,null,(0,t.createElement)(u.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:r}=e;return(0,t.createElement)(u.Button,{onClick:r,"aria-expanded":n,isLink:!0},(0,t.createElement)(p,{dateTimeStart:a}))},renderContent:()=>(0,t.createElement)(E,{dateTimeStart:a,setDateTimeStart:o})})))),(0,t.createElement)(u.PanelRow,null,(0,t.createElement)(u.Flex,null,(0,t.createElement)(u.FlexItem,null,(0,n.__)("End","gatherpress")),(0,t.createElement)(u.FlexItem,null,(0,t.createElement)(u.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:r}=e;return(0,t.createElement)(u.Button,{onClick:r,"aria-expanded":n,isLink:!0},(0,t.createElement)(_,{dateTimeEnd:s}))},renderContent:()=>(0,t.createElement)(P,{dateTimeEnd:s,setDateTimeEnd:l})})))))},S=e=>{const{venue:r,setVenue:a}=e,o=(0,s.useDispatch)("core/editor").editPost,{unlockPostSaving:i}=(0,s.useDispatch)("core/editor"),l=(0,s.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gp_venue"))),c=(0,s.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gp_venue",l))),d=null==c?void 0:c.slug.replace("_venue_",""),g=l+":"+d;(0,t.useEffect)((()=>{var e;a(null!==(e=String(g))&&void 0!==e?e:""),m({setVenueId:d})}));let p=(0,s.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gp_venue",{per_page:-1,context:"view"})),[r]);return p?(p=p.map((e=>({label:e.name,value:e.id+":"+e.slug.replace("_venue_","")}))),p.unshift({value:":",label:(0,n.__)("Choose a venue","gatherpress")})):p=[],(0,t.createElement)(u.PanelRow,null,(0,t.createElement)(u.Flex,null,(0,t.createElement)(u.FlexItem,null,(0,n.__)("Venue","gatherpress")),(0,t.createElement)(u.FlexItem,null,(0,t.createElement)(u.SelectControl,{label:(0,n.__)("Venue","gatherpress"),hideLabelFromVision:"true",value:r,onChange:e=>{(e=>{a(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];o({_gp_venue:t}),m({setVenueId:e[1]}),i()})(e)},options:p,style:{width:"11rem"}}))))};(0,r.registerPlugin)("gp-event-settings",{render:()=>{const[e,r]=(0,t.useState)("");return"gp_event"===wp.data.select("core/editor").getCurrentPostType()&&(0,t.createElement)(a.PluginDocumentSettingPanel,{name:"gp-event-settings",title:(0,n.__)("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(T,null),(0,t.createElement)("hr",null),(0,t.createElement)(S,{venue:e,setVenue:r}))},icon:""})}();